<!DOCTYPE html>
<html lang="ru" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BoardGame Hub - P2P</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root {
            /* –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ (Default) */
            --bg-gradient: radial-gradient(circle at top left, #1a1a2e, #16213e);
            --glass-bg: rgba(255, 255, 255, 0.05);
            --text-main: #e2e2e2;
            --accent: #8b5cf6;
        }

        [data-theme="light"] {
            /* –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ (–î—Ä—É–∂–µ–ª—é–±–Ω–∞—è) */
            --bg-gradient: linear-gradient(135deg, #ffed4a 0%, #ff9800 100%);
            --glass-bg: rgba(255, 255, 255, 0.4);
            --text-main: #4a2c00;
            --accent: #e65100;
        }

        body {
            background: var(--bg-gradient);
            color: var(--text-main);
            font-family: 'Inter', sans-serif;
            transition: all 0.4s ease;
            min-height: 100vh;
        }

        .glass {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–µ—Ç–∫–∞ */
        .main-grid {
            display: grid;
            gap: 1.5rem;
            grid-template-columns: 1fr; /* –ú–æ–±–∏–ª–∫–∏ */
        }

        @media (min-width: 1024px) {
            .main-grid {
                grid-template-columns: 280px 1fr 320px; /* –î–µ—Å–∫—Ç–æ–ø */
            }
        }

        .hidden-screen { display: none !important; }
    </style>
</head>
<body class="p-4">

    <header class="max-w-7xl mx-auto flex justify-between items-center mb-6 p-4 glass">
        <h1 class="text-xl font-bold italic tracking-tighter">BOARDGAME HUB</h1>
        <div class="flex gap-4 items-center">
            <button onclick="toggleTheme()" class="p-2 glass text-xl">üåì</button>
            <div id="net-status" class="text-xs flex items-center gap-2">
                <span class="w-2 h-2 bg-red-500 rounded-full"></span> Offline
            </div>
        </div>
    </header>

    <main id="auth-screen" class="max-w-md mx-auto mt-20 glass p-8 text-center">
        <h2 class="text-2xl font-bold mb-6">–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h2>
        <input id="peer-id-input" type="text" placeholder="ID –∫–æ–º–Ω–∞—Ç—ã (–¥–ª—è –≤—Ö–æ–¥–∞)" class="w-full p-3 mb-4 rounded-lg bg-black/20 border border-white/10 outline-none">
        <div class="grid grid-cols-2 gap-4">
            <button onclick="network.createRoom()" class="bg-blue-600 p-3 rounded-lg font-bold">–°–æ–∑–¥–∞—Ç—å</button>
            <button onclick="network.joinRoom()" class="bg-purple-600 p-3 rounded-lg font-bold">–í–æ–π—Ç–∏</button>
        </div>
        <p id="my-id-display" class="mt-4 text-xs opacity-60"></p>
    </main>

    <main id="lobby-screen" class="max-w-7xl mx-auto main-grid hidden-screen">
        
        <section class="glass p-4">
            <h3 class="font-bold mb-4 border-b border-white/10 pb-2">–ò–≥—Ä–æ–∫–∏</h3>
            <div id="player-list" class="space-y-3">
                </div>
        </section>

        <section class="glass p-6 text-center">
            <h3 class="text-xl font-bold mb-6">–ò–≥—Ä–æ–≤–æ–π —Å—Ç–æ–ª</h3>
            <div id="game-zone" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div onclick="gameManager.selectGame('poker')" class="p-6 glass cursor-pointer border-2 border-transparent hover:border-orange-400 transition-all">
                    <span class="text-4xl">üÉè</span>
                    <h4 class="font-bold mt-2">–ü–æ–∫–µ—Ä</h4>
                </div>
                <div class="p-6 glass opacity-40 cursor-not-allowed">
                    <span class="text-4xl">üïµÔ∏è</span>
                    <h4 class="font-bold mt-2">–ú–∞—Ñ–∏—è</h4>
                </div>
            </div>
            <div id="host-controls" class="mt-10 hidden-screen">
                <button class="bg-orange-500 px-8 py-3 rounded-full font-black animate-bounce">–ù–ê–ß–ê–¢–¨ –ò–ì–†–£</button>
            </div>
        </section>

        <aside class="glass flex flex-col h-[400px] lg:h-auto">
            <div class="p-3 font-bold border-b border-white/10 text-center">–ß–∞—Ç</div>
            <div id="chat-box" class="flex-1 p-4 overflow-y-auto text-sm space-y-2"></div>
            <div class="p-3">
                <input id="chat-input" type="text" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." class="w-full p-2 glass outline-none rounded-lg">
            </div>
        </aside>
    </main>

    <script>
        // --- –®–ê–ì 1: –¢–ï–ú–´ ---
        function toggleTheme() {
            const body = document.documentElement;
            const current = body.getAttribute('data-theme');
            body.setAttribute('data-theme', current === 'dark' ? 'light' : 'dark');
        }

        // --- –®–ê–ì 2: –°–ï–¢–ï–í–ê–Ø –õ–û–ì–ò–ö–ê (PeerJS) --- [cite: 17, 60, 65]
        const network = {
            peer: null,
            conn: null,
            isHost: false,
            connections: [],

            init() {
                this.peer = new Peer();
                this.peer.on('open', (id) => {
                    document.getElementById('my-id-display').innerText = "–í–∞—à —Å–µ—Ç–µ–≤–æ–π ID: " + id;
                    document.getElementById('net-status').innerHTML = '<span class="w-2 h-2 bg-green-500 rounded-full"></span> Online';
                });

                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π (—Ç–æ–ª—å–∫–æ –¥–ª—è –•–æ—Å—Ç–∞) [cite: 17, 61]
                this.peer.on('connection', (c) => {
                    this.isHost = true;
                    this.connections.push(c);
                    this.setupConnHandlers(c);
                    this.broadcast({ type: 'PLAYER_JOINED', name: '–î—Ä—É–≥ –ø–æ–¥–∫–ª—é—á–∏–ª—Å—è' });
                    gameManager.updateLobby();
                });
            },

            createRoom() {
                this.isHost = true;
                document.getElementById('auth-screen').classList.add('hidden-screen');
                document.getElementById('lobby-screen').classList.remove('hidden-screen');
                document.getElementById('host-controls').classList.remove('hidden-screen');
                gameManager.updateLobby();
            },

            joinRoom() {
                const targetId = document.getElementById('peer-id-input').value;
                if (!targetId) return alert("–í–≤–µ–¥–∏—Ç–µ ID —Ö–æ—Å—Ç–∞");
                
                this.conn = this.peer.connect(targetId);
                this.setupConnHandlers(this.conn);
                
                document.getElementById('auth-screen').classList.add('hidden-screen');
                document.getElementById('lobby-screen').classList.remove('hidden-screen');
            },

            setupConnHandlers(c) {
                c.on('data', (data) => {
                    console.log("–ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ:", data);
                    // –õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π —Ç–∏–ø–∞ UPDATE_STATE [cite: 25, 39, 70]
                });
            },

            broadcast(data) {
                this.connections.forEach(c => c.send(data));
            }
        };

        // --- –®–ê–ì 3: –ú–ï–ù–ï–î–ñ–ï–† –ò–ì–†–´ --- 
        const gameManager = {
            players: [{name: '–í—ã (–Ø)', isHost: false}],
            activeModule: null,

            updateLobby() {
                const list = document.getElementById('player-list');
                list.innerHTML = this.players.map(p => `
                    <div class="p-3 glass flex items-center gap-3">
                        <div class="w-8 h-8 rounded-full bg-orange-400"></div>
                        <span>${p.name}</span>
                        <span class="ml-auto text-[10px] bg-green-500/20 p-1 rounded">READY</span>
                    </div>
                `).join('');
            },

            selectGame(gameType) {
                alert("–ú–æ–¥—É–ª—å " + gameType + " –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –≤ –®–∞–≥–µ 4!");
            }
        };

        network.init();
    </script>
</body>
</html>
