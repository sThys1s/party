<!DOCTYPE html>
<html lang="ru" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BoardGame Hub - Poker Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root {
            --bg: radial-gradient(circle at top left, #1a1a2e, #16213e);
            --glass: rgba(255, 255, 255, 0.05);
            --text: #e2e2e2;
            --accent: #8b5cf6;
        }
        [data-theme="light"] {
            --bg: linear-gradient(135deg, #fff9c4 0%, #ffcc80 100%);
            --glass: rgba(255, 255, 255, 0.6);
            --text: #5d4037;
            --accent: #e65100;
        }
        body { background: var(--bg); color: var(--text); transition: 0.3s; min-height: 100vh; font-family: sans-serif; }
        .glass { background: var(--glass); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; }
        
        /* CSS –ö–∞—Ä—Ç—ã */
        .card {
            width: 60px; height: 85px; background: white; border-radius: 5px;
            display: inline-flex; flex-direction: column; align-items: center; justify-content: center;
            font-weight: bold; color: black; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            position: relative; margin: 2px;
        }
        .card.red { color: #e11d48; }
        .card-value { font-size: 1.2rem; }
        .card-suit { font-size: 1.5rem; }

        /* –°–µ—Ç–∫–∞ */
        .app-container { display: grid; gap: 1rem; grid-template-columns: 1fr; }
        @media (min-width: 1024px) { .app-container { grid-template-columns: 250px 1fr 300px; } }
        .hidden { display: none !important; }
    </style>
</head>
<body class="p-4">

    <header class="max-w-7xl mx-auto flex justify-between items-center mb-4 p-4 glass">
        <h1 class="font-bold">BOARDGAME HUB</h1>
        <div class="flex gap-2">
            <button onclick="toggleTheme()" class="p-2 glass">üåì</button>
            <button onclick="ui.toggleProfile()" class="p-2 glass">üë§ –ü—Ä–æ—Ñ–∏–ª—å</button>
        </div>
    </header>

    <div id="profile-panel" class="max-w-md mx-auto mb-4 p-4 glass hidden">
        <h3 class="font-bold mb-2">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è</h3>
        <input id="p-name" type="text" placeholder="–í–∞—à –Ω–∏–∫" class="w-full p-2 mb-2 rounded bg-black/10">
        <select id="p-avatar" class="w-full p-2 mb-2 rounded bg-black/10">
            <option value="ü¶ä">–õ–∏—Å</option>
            <option value="üê±">–ö–æ—Ç</option>
            <option value="üê∂">–ü–µ—Å</option>
        </select>
        <button onclick="ui.saveProfile()" class="w-full bg-green-600 p-2 rounded text-white">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>

    <div id="auth-screen" class="max-w-md mx-auto mt-10 p-6 glass text-center">
        <h2 class="text-xl mb-4">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</h2>
        <input id="join-id" type="text" placeholder="ID –∫–æ–º–Ω–∞—Ç—ã" class="w-full p-2 mb-2 rounded bg-black/10">
        <div class="flex gap-2">
            <button onclick="network.init(true)" class="flex-1 bg-purple-600 p-2 rounded">–°–æ–∑–¥–∞—Ç—å</button>
            <button onclick="network.init(false)" class="flex-1 bg-blue-600 p-2 rounded">–í–æ–π—Ç–∏</button>
        </div>
        <p id="my-peer-id" class="text-[10px] mt-4 opacity-50"></p>
    </div>

    <main id="main-ui" class="max-w-7xl mx-auto app-container hidden">
        <aside class="glass p-4">
            <h3 class="font-bold border-b pb-2 mb-2">–ò–≥—Ä–æ–∫–∏</h3>
            <div id="player-list" class="space-y-2"></div>
        </aside>

        <section class="glass p-4 text-center">
            <div id="game-selection">
                <h2 class="text-lg mb-4">–í—ã–±–æ—Ä –∏–≥—Ä—ã</h2>
                <div class="grid grid-cols-2 gap-4">
                    <div onclick="gameManager.startPoker()" class="p-4 glass cursor-pointer border-2 border-transparent hover:border-orange-500">
                        <span class="text-3xl">üÉè</span><p>–ü–æ–∫–µ—Ä</p>
                    </div>
                </div>
            </div>
            
            <div id="poker-table" class="hidden">
                <div id="community-cards" class="mb-8 min-h-[90px] border-2 border-dashed border-white/10 rounded-lg flex items-center justify-center"></div>
                <div id="my-hand" class="p-4 glass inline-block">
                    <p class="text-xs mb-2 italic">–í–∞—à–∏ –∫–∞—Ä—Ç—ã:</p>
                    <div id="cards-container"></div>
                </div>
                <div id="controls" class="mt-4 flex justify-center gap-2">
                    <button class="px-4 py-2 bg-red-800 rounded">Fold</button>
                    <button class="px-4 py-2 bg-blue-700 rounded">Call/Check</button>
                </div>
            </div>
        </section>

        <aside class="glass flex flex-col h-[300px] lg:h-auto">
            <div class="p-2 border-b text-center font-bold">–ß–∞—Ç</div>
            <div id="chat" class="flex-1 p-2 overflow-y-auto text-sm"></div>
            <input id="chat-msg" type="text" placeholder="–ü—Å—Å..." class="p-2 bg-transparent border-t outline-none">
        </aside>
    </main>

    <script>
        // --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ---
        let user = { name: "–ò–≥—Ä–æ–∫", avatar: "ü¶ä", id: null };
        const suits = { 'h': '‚ô•', 'd': '‚ô¶', 'c': '‚ô£', 's': '‚ô†' };

        // --- –°–ï–¢–ï–í–ê–Ø –õ–û–ì–ò–ö–ê (PeerJS) ---
        const network = {
            peer: null,
            conns: [],
            isHost: false,

            init(isHost) {
                this.isHost = isHost;
                this.peer = new Peer();
                this.peer.on('open', id => {
                    user.id = id;
                    document.getElementById('my-peer-id').innerText = "ID –∫–æ–º–Ω–∞—Ç—ã: " + id;
                    if (!isHost) this.connectToHost();
                    else ui.showMain();
                });

                this.peer.on('connection', conn => {
                    this.conns.push(conn);
                    this.handleData(conn);
                });
            },

            connectToHost() {
                const hostId = document.getElementById('join-id').value;
                const conn = this.peer.connect(hostId);
                this.conns.push(conn);
                this.handleData(conn);
                ui.showMain();
            },

            handleData(conn) {
                conn.on('open', () => {
                    conn.send({ type: 'HANDSHAKE', user });
                });
                conn.on('data', data => {
                    if (data.type === 'UPDATE_PLAYERS') ui.renderPlayers(data.players);
                    if (data.type === 'START_POKER') gameManager.initPoker(data.state);
                });
            },

            broadcast(data) {
                this.conns.forEach(c => c.send(data));
            }
        };

        // --- –ü–û–ö–ï–†–ù–´–ô –ú–û–î–£–õ–¨ (–®–∞–≥ 4) ---
        class PokerGame {
            constructor() {
                this.deck = this.createDeck();
            }
            createDeck() {
                const values = ['2','3','4','5','6','7','8','9','10','J','Q','K','A'];
                let deck = [];
                for(let s in suits) values.forEach(v => deck.push({v, s}));
                return deck.sort(() => Math.random() - 0.5);
            }
            deal(n) { return this.deck.splice(0, n); }
        }

        const gameManager = {
            instance: null,
            startPoker() {
                if (!network.isHost) return;
                this.instance = new PokerGame();
                // –†–∞–∑–¥–∞–µ–º –∫–∞—Ä—Ç—ã (—É–ø—Ä–æ—â–µ–Ω–Ω–æ –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞)
                const state = { community: this.instance.deal(3), mine: this.instance.deal(2) };
                network.broadcast({ type: 'START_POKER', state });
                this.initPoker(state);
            },
            initPoker(state) {
                document.getElementById('game-selection').classList.add('hidden');
                document.getElementById('poker-table').classList.remove('hidden');
                ui.renderCards('community-cards', state.community);
                ui.renderCards('cards-container', state.mine);
            }
        };

        // --- UI –õ–û–ì–ò–ö–ê ---
        const ui = {
            toggleProfile() { document.getElementById('profile-panel').classList.toggle('hidden'); },
            saveProfile() {
                user.name = document.getElementById('p-name').value || "–ò–≥—Ä–æ–∫";
                user.avatar = document.getElementById('p-avatar').value;
                this.toggleProfile();
            },
            showMain() {
                document.getElementById('auth-screen').classList.add('hidden');
                document.getElementById('main-ui').classList.remove('hidden');
            },
            renderPlayers(players) {
                const list = document.getElementById('player-list');
                list.innerHTML = players.map(p => `<div class="p-2 glass">${p.avatar} ${p.name}</div>`).join('');
            },
            renderCards(containerId, cards) {
                const container = document.getElementById(containerId);
                container.innerHTML = cards.map(c => `
                    <div class="card ${c.s === 'h' || c.s === 'd' ? 'red' : ''}">
                        <div class="card-value">${c.v}</div>
                        <div class="card-suit">${suits[c.s]}</div>
                    </div>
                `).join('');
            }
        };

        function toggleTheme() {
            const html = document.documentElement;
            html.setAttribute('data-theme', html.getAttribute('data-theme') === 'dark' ? 'light' : 'dark');
        }
    </script>
</body>
</html>
