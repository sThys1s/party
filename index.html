<!DOCTYPE html>
<html lang="ru" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BoardGame Hub - Poker Alpha</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        /* --- VISUAL CORE based on TS --- */
        :root {
            --bg-gradient: radial-gradient(circle at top left, #1a1a2e, #16213e);
            --glass-bg: rgba(255, 255, 255, 0.05);
            --text-main: #e2e2e2;
        }
        body {
            background: var(--bg-gradient);
            color: var(--text-main);
            font-family: 'Segoe UI', sans-serif;
            min-height: 100vh;
        }
        .glass {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }
        .hidden-screen { display: none !important; }
        
        /* Card Styles (CSS Fallback if images missing) */
        .playing-card {
            width: 60px; height: 90px;
            background: white; color: black;
            border-radius: 6px;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            font-weight: bold; position: relative;
            user-select: none;
        }
        .suit-red { color: #d93025; }
        .suit-black { color: #1a1a1a; }
        
        /* Table Layout */
        .poker-table {
            background: radial-gradient(#2e7d32, #1b5e20);
            border: 8px solid #3e2723;
            border-radius: 100px;
            position: relative;
            min-height: 400px;
        }
    </style>
</head>
<body class="p-4 flex flex-col items-center">

    <header class="w-full max-w-6xl flex justify-between items-center mb-6 p-4 glass">
        <h1 class="text-xl font-bold tracking-tighter text-purple-400">BOARDGAME HUB</h1>
        <div class="flex gap-4 items-center">
            <div id="net-status" class="text-xs flex items-center gap-2">
                <span class="w-2 h-2 bg-red-500 rounded-full" id="status-dot"></span> 
                <span id="status-text">Offline</span>
            </div>
        </div>
    </header>

    <main id="profile-screen" class="w-full max-w-md glass p-8 text-center">
        <h2 class="text-2xl font-bold mb-4">–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å</h2>
        <input id="nickname" type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –Ω–∏–∫–Ω–µ–π–º" class="w-full p-3 mb-4 rounded-lg bg-black/20 border border-white/10 outline-none text-white">
        <button onclick="ui.goToAuth()" class="w-full bg-purple-600 hover:bg-purple-700 p-3 rounded-lg font-bold transition">–î–∞–ª–µ–µ</button>
    </main>

    <main id="auth-screen" class="w-full max-w-md glass p-8 text-center hidden-screen">
        <h2 class="text-2xl font-bold mb-6">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</h2>
        <div class="mb-4 text-left">
            <label class="text-xs opacity-60">ID –ö–æ–º–Ω–∞—Ç—ã (–¥–ª—è –≤—Ö–æ–¥–∞):</label>
            <input id="peer-id-input" type="text" class="w-full p-3 rounded-lg bg-black/20 border border-white/10 outline-none text-white">
        </div>
        <div class="grid grid-cols-2 gap-4">
            <button onclick="network.createRoom()" class="bg-blue-600 hover:bg-blue-700 p-3 rounded-lg font-bold transition">–°–æ–∑–¥–∞—Ç—å</button>
            <button onclick="network.joinRoom()" class="bg-green-600 hover:bg-green-700 p-3 rounded-lg font-bold transition">–í–æ–π—Ç–∏</button>
        </div>
        <p id="my-id-display" class="mt-4 text-[10px] opacity-60 font-mono select-all cursor-pointer bg-black/30 p-2 rounded"></p>
    </main>

    <main id="lobby-screen" class="w-full max-w-6xl grid grid-cols-1 lg:grid-cols-4 gap-4 hidden-screen">
        
        <aside class="lg:col-span-1 space-y-4">
            <div class="glass p-4 min-h-[200px]">
                <h3 class="font-bold mb-2 text-sm uppercase tracking-wider opacity-70">–ò–≥—Ä–æ–∫–∏</h3>
                <div id="player-list" class="space-y-2"></div>
                <button id="btn-ready" onclick="gameManager.toggleReady()" class="w-full mt-4 bg-gray-600 py-2 rounded font-bold text-sm hover:bg-gray-500">–Ø –ì–û–¢–û–í</button>
            </div>
            
            <div class="glass flex flex-col h-[300px]">
                <div class="p-3 font-bold border-b border-white/10 text-sm">–ß–∞—Ç –∫–æ–º–Ω–∞—Ç—ã</div>
                <div id="chat-box" class="flex-1 p-3 overflow-y-auto text-xs space-y-2"></div>
                <input id="chat-input" onkeypress="if(event.key === 'Enter') gameManager.sendChat()" type="text" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." class="w-full p-3 bg-transparent outline-none border-t border-white/10 text-sm">
            </div>
        </aside>

        <section class="lg:col-span-3 space-y-4">
            
            <div id="game-selector" class="glass p-8 text-center">
                <h3 class="text-2xl font-bold mb-8">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 max-w-2xl mx-auto">
                    <div onclick="gameManager.voteForGame('poker')" class="p-6 glass cursor-pointer border-2 border-transparent hover:border-purple-500 transition-all group">
                        <div class="text-5xl mb-4 group-hover:scale-110 transition">üÉè</div>
                        <h4 class="font-bold text-xl">Poker Texas Hold'em</h4>
                        <p class="text-xs mt-2 opacity-60">–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –ø–æ–∫–µ—Ä. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–æ 6 –∏–≥—Ä–æ–∫–æ–≤.</p>
                    </div>
                    <div class="p-6 glass opacity-40 cursor-not-allowed grayscale">
                        <div class="text-5xl mb-4">üïµÔ∏è</div>
                        <h4 class="font-bold text-xl">Mafia</h4>
                        <p class="text-xs mt-2 opacity-60">–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ...</p>
                    </div>
                </div>
                
                <div id="host-controls" class="mt-10 hidden-screen">
                    <p class="text-sm text-yellow-500 mb-2">–í—ã ‚Äî –•–æ—Å—Ç. –û–∂–∏–¥–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∏–≥—Ä–æ–∫–æ–≤...</p>
                    <button id="btn-start" onclick="gameManager.tryStartGame()" class="bg-gradient-to-r from-orange-500 to-red-600 px-10 py-3 rounded-full font-black tracking-widest opacity-50 cursor-not-allowed">–ù–ê–ß–ê–¢–¨</button>
                </div>
            </div>

            <div id="game-view" class="hidden-screen">
                <div class="poker-table w-full flex flex-col items-center justify-center p-4 shadow-2xl">
                    
                    <div class="text-white/60 text-xs mb-2 uppercase tracking-widest">–°—Ç–æ–ª (Board)</div>
                    <div id="community-cards" class="flex gap-2 mb-8 min-h-[90px]">
                        </div>

                    <div class="bg-black/40 px-6 py-2 rounded-full border border-yellow-500/30 text-yellow-400 font-mono mb-8">
                        –ë–∞–Ω–∫: $<span id="pot-display">0</span>
                    </div>

                    <div id="player-controls" class="flex gap-2 mb-4 hidden-screen">
                        <button onclick="gameManager.sendAction('fold')" class="bg-red-900/80 hover:bg-red-600 px-4 py-2 rounded border border-red-500 text-sm font-bold">Fold</button>
                        <button onclick="gameManager.sendAction('check')" class="bg-blue-900/80 hover:bg-blue-600 px-4 py-2 rounded border border-blue-500 text-sm font-bold">Check</button>
                        <button onclick="gameManager.sendAction('call')" class="bg-green-900/80 hover:bg-green-600 px-4 py-2 rounded border border-green-500 text-sm font-bold">Call</button>
                        <button onclick="gameManager.sendAction('raise')" class="bg-yellow-900/80 hover:bg-yellow-600 px-4 py-2 rounded border border-yellow-500 text-sm font-bold">Raise 100</button>
                    </div>
                    
                    <div id="game-status-text" class="text-sm font-bold animate-pulse text-purple-300">–û–∂–∏–¥–∞–Ω–∏–µ —Ö–æ–¥–∞...</div>
                </div>

                <div class="mt-6 flex flex-col items-center">
                    <div class="text-xs opacity-50 mb-1">–í–∞—à–∞ —Ä—É–∫–∞</div>
                    <div id="my-hand" class="flex gap-2"></div>
                </div>
            </div>

        </section>
    </main>

    <script>
        // --- 1. CORE UTILS & CLASSES ---

        // Simple Card Class [cite: 23]
        class Card {
            constructor(suit, value) {
                this.suit = suit; // 'h', 'd', 'c', 's'
                this.value = value; // 2-14 (14 is Ace)
            }
            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è HTML –∫–∞—Ä—Ç—ã (–º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ <img>) [cite: 30]
            render() {
                const suits = {'h': '‚ô•', 'd': '‚ô¶', 'c': '‚ô£', 's': '‚ô†'};
                const colors = {'h': 'suit-red', 'd': 'suit-red', 'c': 'suit-black', 's': 'suit-black'};
                const valMap = {11:'J', 12:'Q', 13:'K', 14:'A'};
                const displayVal = valMap[this.value] || this.value;
                
                // –ï—Å–ª–∏ –Ω—É–∂–Ω—ã –∫–∞—Ä—Ç–∏–Ω–∫–∏, —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å—Ç—Ä–æ–∫—É –Ω–∏–∂–µ –∏ —É–¥–∞–ª–∏—Ç–µ –æ—Å—Ç–∞–ª—å–Ω–æ–µ –≤ —ç—Ç–æ–º –º–µ—Ç–æ–¥–µ
                // return `<img src="./assets/cards/${this.value}_${this.suit}.png" class="w-[60px]">`;

                return `
                    <div class="playing-card border border-gray-300 shadow-lg">
                        <div class="text-lg ${colors[this.suit]}">${suits[this.suit]}</div>
                        <div class="text-sm font-bold text-black">${displayVal}</div>
                    </div>
                `;
            }
        }

        class Deck {
            constructor() {
                this.cards = [];
                const suits = ['h', 'd', 'c', 's'];
                for (let s of suits) {
                    for (let v = 2; v <= 14; v++) this.cards.push(new Card(s, v));
                }
            }
            shuffle() {
                this.cards.sort(() => Math.random() - 0.5);
            }
            deal() { return this.cards.pop(); }
        }

        // --- 2. GAME LOGIC (POKER MODULE) --- [cite: 32, 69]
        const PokerModule = {
            state: {
                phase: 'preflop', // preflop, flop, turn, river
                pot: 0,
                communityCards: [],
                hands: {}, // {peerId: [Card, Card]}
                currentTurnIndex: 0,
                deck: null
            },

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–æ–≤–æ–π –∏–≥—Ä—ã (–¢–æ–ª—å–∫–æ –•–æ—Å—Ç)
            initGame(playerIds) {
                this.state.deck = new Deck();
                this.state.deck.shuffle();
                this.state.communityCards = [];
                this.state.pot = 0;
                this.state.hands = {};
                
                // –†–∞–∑–¥–∞—á–∞ –∫–∞—Ä—Ç [cite: 35]
                playerIds.forEach(id => {
                    this.state.hands[id] = [this.state.deck.deal(), this.state.deck.deal()];
                });

                return this.state;
            },

            // –ü—Ä–æ—Å—Ç–æ–π –ø–µ—Ä–µ—Ö–æ–¥ —Ö–æ–¥–∞ (Logic stub)
            nextPhase() {
                const deck = this.state.deck;
                if(this.state.communityCards.length === 0) {
                    this.state.communityCards.push(deck.deal(), deck.deal(), deck.deal()); // Flop
                } else if (this.state.communityCards.length < 5) {
                    this.state.communityCards.push(deck.deal()); // Turn/River
                }
            }
        };

        // --- 3. NETWORK MANAGER (PeerJS) --- [cite: 17, 60]
        const network = {
            peer: null,
            connections: [], // List of DataConnections (Host only)
            hostConn: null,  // Connection to Host (Client only)
            myId: null,

            init() {
                this.peer = new Peer();
                
                this.peer.on('open', (id) => {
                    this.myId = id;
                    document.getElementById('my-id-display').innerText = id;
                    this.setStatus(true);
                });

                this.peer.on('error', (err) => alert("–û—à–∏–±–∫–∞ PeerJS: " + err));

                // –õ–æ–≥–∏–∫–∞ –•–æ—Å—Ç–∞: –í—Ö–æ–¥—è—â–µ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
                this.peer.on('connection', (conn) => {
                    this.connections.push(conn);
                    this.setupDataHandler(conn);
                    
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–º—É –∏–≥—Ä–æ–∫—É —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ª–æ–±–±–∏
                    setTimeout(() => {
                         gameManager.hostHandleJoin(conn.peer);
                    }, 500);
                });
            },

            setStatus(online) {
                const el = document.getElementById('status-dot');
                const txt = document.getElementById('status-text');
                if(online) {
                    el.classList.replace('bg-red-500', 'bg-green-500');
                    txt.innerText = "Online";
                }
            },

            createRoom() {
                gameManager.isHost = true;
                gameManager.players.push({
                    id: this.myId, 
                    name: ui.nickname, 
                    isHost: true, 
                    ready: true
                });
                ui.showLobby();
                ui.updatePlayerList();
            },

            joinRoom() {
                const hostId = document.getElementById('peer-id-input').value.trim();
                if(!hostId) return alert("–í–≤–µ–¥–∏—Ç–µ ID");
                
                this.hostConn = this.peer.connect(hostId);
                
                this.hostConn.on('open', () => {
                    ui.showLobby();
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ —Ö–æ—Å—Ç—É 
                    this.sendToHost({
                        type: 'JOIN_REQUEST',
                        payload: { name: ui.nickname }
                    });
                });

                this.setupDataHandler(this.hostConn);
            },

            setupDataHandler(conn) {
                conn.on('data', (data) => {
                    // –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π [cite: 39]
                    gameManager.handleMessage(data, conn.peer);
                });
                conn.on('close', () => {
                    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑—Ä—ã–≤–∞ [cite: 27]
                    if(gameManager.isHost) {
                        gameManager.players = gameManager.players.filter(p => p.id !== conn.peer);
                        gameManager.broadcastLobbyState();
                    } else {
                        alert("–•–æ—Å—Ç –æ—Ç–∫–ª—é—á–∏–ª—Å—è");
                        location.reload();
                    }
                });
            },

            // –ú–µ—Ç–æ–¥—ã –æ—Ç–ø—Ä–∞–≤–∫–∏
            sendToHost(msg) { if(this.hostConn) this.hostConn.send(msg); },
            broadcast(msg) { this.connections.forEach(c => c.send(msg)); }
        };

        // --- 4. GAME MANAGER (Orchestrator) --- [cite: 18, 31]
        const gameManager = {
            isHost: false,
            players: [], // [{id, name, ready, isHost}]
            gameState: null, 

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
            handleMessage(msg, senderId) {
                console.log("MSG:", msg);
                
                switch(msg.type) {
                    // --- –õ–û–ì–ò–ö–ê –•–û–°–¢–ê ---
                    case 'JOIN_REQUEST':
                        if(!this.isHost) return;
                        this.players.push({
                            id: senderId,
                            name: msg.payload.name,
                            ready: false,
                            isHost: false
                        });
                        this.broadcastLobbyState();
                        break;
                    
                    case 'TOGGLE_READY':
                        if(!this.isHost) return;
                        const p = this.players.find(x => x.id === senderId);
                        if(p) p.ready = !p.ready;
                        this.broadcastLobbyState();
                        break;

                    case 'CHAT_MSG':
                        ui.addChatMessage(msg.payload.name, msg.payload.text);
                        if(this.isHost) network.broadcast(msg); // –†–µ–±—Ä–æ–¥–∫–∞—Å—Ç –≤—Å–µ–º
                        break;

                    case 'GAME_ACTION': 
                        // –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ö–æ–¥–∞ [cite: 39]
                        this.processGameAction(senderId, msg.payload);
                        break;

                    // --- –õ–û–ì–ò–ö–ê –ö–õ–ò–ï–ù–¢–ê ---
                    case 'LOBBY_UPDATE':
                        this.players = msg.payload;
                        ui.updatePlayerList();
                        break;

                    case 'GAME_START':
                        ui.startGameUI();
                        break;

                    case 'GAME_STATE_UPDATE':
                        this.syncGameState(msg.payload);
                        break;
                }
            },

            // Host Actions
            hostHandleJoin(peerId) {
                // Initial sync logic handled in message parser
            },

            broadcastLobbyState() {
                const state = { type: 'LOBBY_UPDATE', payload: this.players };
                network.broadcast(state);
                ui.updatePlayerList(); // Update host UI too
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–Ω–æ–ø–∫–∏ —Å—Ç–∞—Ä—Ç [cite: 22]
                const allReady = this.players.every(p => p.ready) && this.players.length > 1;
                const btn = document.getElementById('btn-start');
                if(btn) {
                    btn.classList.toggle('opacity-50', !allReady);
                    btn.classList.toggle('cursor-not-allowed', !allReady);
                }
            },

            tryStartGame() {
                const allReady = this.players.every(p => p.ready);
                if(allReady && this.players.length > 1) {
                    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ü–æ–∫–µ—Ä–∞
                    const initialData = PokerModule.initGame(this.players.map(p => p.id));
                    
                    network.broadcast({ type: 'GAME_START' });
                    this.broadcastGameState(initialData);
                    
                    ui.startGameUI(); // –î–ª—è —Ö–æ—Å—Ç–∞
                    this.syncGameState(initialData); // –î–ª—è —Ö–æ—Å—Ç–∞
                } else {
                    alert("–ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 2 –∏–≥—Ä–æ–∫–∞ –∏ –≤—Å–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≥–æ—Ç–æ–≤—ã!");
                }
            },

            processGameAction(playerId, action) {
                // –ó–∞–≥–ª—É—à–∫–∞ –ª–æ–≥–∏–∫–∏: –ü—Ä–æ—Å—Ç–æ –∫—Ä—É—Ç–∏–º –∫–∞—Ä—Ç—ã –¥–∞–ª—å—à–µ
                if(action === 'fold' || action === 'check' || action === 'call' || action === 'raise') {
                    PokerModule.nextPhase();
                    this.broadcastGameState(PokerModule.state);
                }
            },

            broadcastGameState(state) {
                // –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è: –ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —á—É–∂–∏–µ –∫–∞—Ä—Ç—ã! (–£–ø—Ä–æ—â–µ–Ω–æ –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞)
                // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–¥–µ –∑–¥–µ—Å—å –Ω—É–∂–Ω–æ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å hands –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
                network.broadcast({
                    type: 'GAME_STATE_UPDATE',
                    payload: state
                });
                this.syncGameState(state); // Update host
            },

            // Client Actions
            toggleReady() {
                if(this.isHost) return; // –•–æ—Å—Ç –≤—Å–µ–≥–¥–∞ –≥–æ—Ç–æ–≤
                network.sendToHost({ type: 'TOGGLE_READY' });
                
                // –í–∏–∑—É–∞–ª—å–Ω–æ –º–µ–Ω—è–µ–º –∫–Ω–æ–ø–∫—É —Å—Ä–∞–∑—É (Optimistic UI)
                const btn = document.getElementById('btn-ready');
                btn.innerText = btn.innerText === "–Ø –ì–û–¢–û–í" ? "–û–¢–ú–ï–ù–ê" : "–Ø –ì–û–¢–û–í";
                btn.classList.toggle('bg-green-600');
            },

            sendChat() {
                const input = document.getElementById('chat-input');
                const text = input.value;
                if(!text) return;
                
                const msg = { type: 'CHAT_MSG', payload: { name: ui.nickname, text } };
                if(this.isHost) {
                    network.broadcast(msg);
                    ui.addChatMessage(ui.nickname, text);
                } else {
                    network.sendToHost(msg);
                }
                input.value = '';
            },

            sendAction(actionType) {
                if(this.isHost) {
                    this.processGameAction(network.myId, actionType);
                } else {
                    network.sendToHost({
                        type: 'GAME_ACTION',
                        payload: actionType
                    });
                }
            },

            // Sync Logic
            syncGameState(serverState) {
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–æ–ª–∞
                const commContainer = document.getElementById('community-cards');
                commContainer.innerHTML = '';
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—ä–µ–∫—Ç—ã Card –∏–∑ JSON
                serverState.communityCards.forEach(c => {
                    const card = new Card(c.suit, c.value);
                    const div = document.createElement('div');
                    div.innerHTML = card.render();
                    commContainer.appendChild(div.firstElementChild);
                });

                document.getElementById('pot-display').innerText = serverState.pot;
                document.getElementById('game-status-text').innerText = `–§–∞–∑–∞: ${serverState.phase}`;

                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–≤–æ–µ–π —Ä—É–∫–∏
                const myHand = serverState.hands[network.myId];
                if(myHand) {
                    const handContainer = document.getElementById('my-hand');
                    handContainer.innerHTML = '';
                    myHand.forEach(c => {
                        const card = new Card(c.suit, c.value);
                        const div = document.createElement('div');
                        div.innerHTML = card.render();
                        handContainer.appendChild(div.firstElementChild);
                    });
                }
            }
        };

        // --- 5. UI CONTROLLER ---
        const ui = {
            nickname: "Player",
            
            goToAuth() {
                const nick = document.getElementById('nickname').value;
                if(!nick) return alert("–í–≤–µ–¥–∏—Ç–µ –∏–º—è!");
                this.nickname = nick;
                
                document.getElementById('profile-screen').classList.add('hidden-screen');
                document.getElementById('auth-screen').classList.remove('hidden-screen');
                
                network.init(); // Start PeerJS only after profile
            },

            showLobby() {
                document.getElementById('auth-screen').classList.add('hidden-screen');
                document.getElementById('lobby-screen').classList.remove('hidden-screen');
                if(gameManager.isHost) {
                    document.getElementById('host-controls').classList.remove('hidden-screen');
                }
            },

            updatePlayerList() {
                const list = document.getElementById('player-list');
                list.innerHTML = gameManager.players.map(p => `
                    <div class="p-2 glass flex items-center gap-3 border-l-4 ${p.ready ? 'border-green-500' : 'border-red-500'}">
                        <div class="w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-indigo-500 flex items-center justify-center font-bold text-xs">
                            ${p.name.substring(0,2).toUpperCase()}
                        </div>
                        <span class="text-sm font-medium">${p.name} ${p.isHost ? 'üëë' : ''}</span>
                        ${p.ready ? '<span class="ml-auto text-[10px] bg-green-500/20 text-green-300 px-2 py-1 rounded">READY</span>' : ''}
                    </div>
                `).join('');
            },

            startGameUI() {
                document.getElementById('game-selector').classList.add('hidden-screen');
                document.getElementById('game-view').classList.remove('hidden-screen');
                document.getElementById('player-controls').classList.remove('hidden-screen');
            },

            addChatMessage(name, text) {
                const box = document.getElementById('chat-box');
                box.innerHTML += `<div class="mb-1"><span class="font-bold text-purple-400">${name}:</span> ${text}</div>`;
                box.scrollTop = box.scrollHeight;
            }
        };

    </script>
</body>
</html>
